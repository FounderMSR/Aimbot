--// Settings
local Settings = {
    Aimbot = {
        Enabled = nil,
        Teamcheck = nil,
        Alivecheck = nil,
        Mode = nil,
        Stickyaim = nil,
        Alerts = nil,
        Aimpart = nil,
        Aimkey = nil,
        Distancecheck = {
            Enabled = nil,
            Value = nil
        },
        Smoothness = {
            Enabled = nil,
            SmoothnessValue = nil
        },
        Prediction = {
            Enabled = nil,
            PredValue = nil,
        },
        Fov = {
            Enabled = nil,
            Radius = nil,
            Color = nil
        },
        Shake = {
            Enabled = nil,
            ShakeValue = nil
        },
    }, 
    Blatant = {
        CFrameSpeed = {
            Enabled = nil,
            Value = nil
        },
        Fly = {
            Value = nil
        },
        MessageSpammer = {
            Enabled = nil,
            Message = nil,
            UseEmojis = nil
        },
    },
    Visuals = {
        Local = {
            Light = {
                Enabled = nil,
                Color = nil,
                Strength = nil
            },
            AspectRatio = {
                Enabled = nil,
                Value = nil
            },
            CloneChams = {
                Enabled = nil,
                Duration = nil,
                Color = nil,
                Material = nil
            },
            Nametag = {
                Enabled = nil,
                Color = nil
            },
        },
    },
}

--// Variables
local lplr = game:GetService("Players").LocalPlayer
local TweenService = game:GetService("TweenService")
local CurrentCamera = workspace.CurrentCamera
local lockedPlayer = nil
local aimbotkeybind = false 
local stickyLockedPlayer = nil
local mousemoverel = mousemoverel or (Input and Input.MouseMove)
local funny = {"unreadable code", "pasted code"}
local day = os.date(" %d", os.time())
local second_string = ", %Y."
local worldToViewportPoint = CurrentCamera.worldToViewportPoint
local mouse = lplr:GetMouse()
local UserInput = game:GetService("UserInputService")


--// get sub prefix or smth lmfao
function GetSubPrefix(str)
    local str = tostring(str):gsub(" ", "")
    local var = ""

    if #str == 2 then
        local sec = string.sub(str, #str, #str + 1)
        var = sec == "1" and "st" or sec == "2" and "nd" or sec == "3" and "rd" or "th"
    end

    return var
end


--// Library
local repo = "https://raw.githubusercontent.com/wally-rblx/LinoriaLib/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

--// pasted esp no way
getgenv().taffy_esp = {
    box = {
        enabled1 = true,
        enabled = false,
        outline = false,
        healthbar = false,
        color1 = Color3.fromRGB(255, 255, 255),
        color2 = Color3.fromRGB(0, 0, 0),
        healthbarcolor = Color3.fromRGB(4, 0, 255)
    },
    tracer = {
        enabled = false,
        unlocktracers = false,
        color = Color3.fromRGB(255, 255, 255)
    },
    name = {
        enabled = false,
        outline = false,
        size = 13,
        font = 2,
        color = Color3.fromRGB(255, 255, 255)
    },
    misc = {
        teamcheck = false,
        useteamcolors = false,
        visibleonly = true
    },
    Toolsshow = {
        enable = false,
        outline = false,
        size = 8,
        font = 3,
        color = Color3.fromRGB(147, 39, 161)
    }
}

function esp(v)
    local BLOCKOUTLINE = Drawing.new("Square")
    BLOCKOUTLINE.Visible = false
    BLOCKOUTLINE.Color = Color3.new(0, 0, 0)
    BLOCKOUTLINE.Thickness = 3
    BLOCKOUTLINE.Transparency = 1
    BLOCKOUTLINE.Filled = false
    local BOXPLAYER = Drawing.new("Square")
    BOXPLAYER.Visible = false
    BOXPLAYER.Color = taffy_esp.box.color1
    BOXPLAYER.Thickness = 1
    BOXPLAYER.Transparency = 1
    BOXPLAYER.Filled = false
    local HealthBarOUTLINE = Drawing.new("Square")
    HealthBarOUTLINE.Thickness = 3
    HealthBarOUTLINE.Filled = false
    HealthBarOUTLINE.Color = Color3.new(0, 0, 0)
    HealthBarOUTLINE.Transparency = 1
    HealthBarOUTLINE.Visible = false
    local HealthBarITSELF = Drawing.new("Square")
    HealthBarITSELF.Thickness = 1
    HealthBarITSELF.Filled = false
    HealthBarITSELF.Transparency = 1
    HealthBarITSELF.Visible = false
    local Tracer = Drawing.new("Line")
    Tracer.Visible = false
    Tracer.Color = Color3.new(1, 1, 1)
    Tracer.Thickness = 1
    Tracer.Transparency = 1
    local Name = Drawing.new("Text")
    Name.Transparency = 1
    Name.Visible = false
    Name.Color = taffy_esp.name.color
    Name.Size = 16
    Name.Center = true
    Name.Outline = false
    Name.Font = 2
    Name.Text = "name [100/100]"
    local toolshow = Drawing.new("Text")
    toolshow.Transparency = 1
    toolshow.Visible = false
    toolshow.Color = getgenv().taffy_esp.Toolsshow.color
    toolshow.Size = 16
    toolshow.Center = true
    toolshow.Outline = false
    toolshow.Font = 2
    toolshow.Text = ""

    game:GetService("RunService").RenderStepped:Connect(function()
        if v.Character ~= nil and v.Character:FindFirstChild("Humanoid") ~= nil and v.Character:FindFirstChild("HumanoidRootPart") ~= nil and v ~= lplr and v.Character.Humanoid.Health > 0 and (not taffy_esp.misc.teamcheck or v.TeamColor ~= lplr.TeamColor) and v.Character:FindFirstChild("Head") ~= nil then
            local Vector, onScreen = CurrentCamera:worldToViewportPoint(v.Character.HumanoidRootPart.Position)
            local Distance = (CurrentCamera.CFrame.p - v.Character.HumanoidRootPart.Position).Magnitude
            local RootPart = v.Character.HumanoidRootPart
            local Head = v.Character.Head
            local RootPosition, RootVis = worldToViewportPoint(CurrentCamera, RootPart.Position)
            local HeadPosition = worldToViewportPoint(CurrentCamera, Head.Position + Vector3.new(0, 0.5, 0))
            local LegPosition = worldToViewportPoint(CurrentCamera, RootPart.Position - Vector3.new(0, 3, 0))

            if not taffy_esp.misc.visibleonly or onScreen then
                if taffy_esp.box.enabled1 then
                    BLOCKOUTLINE.Size = Vector2.new(2500 / RootPosition.Z, HeadPosition.Y - LegPosition.Y)
                    BLOCKOUTLINE.Position = Vector2.new(RootPosition.X - BLOCKOUTLINE.Size.X / 2, RootPosition.Y - BLOCKOUTLINE.Size.Y / 2)
                    BLOCKOUTLINE.Visible = taffy_esp.box.outline
                    BLOCKOUTLINE.Color = taffy_esp.box.color2
                    BOXPLAYER.Size = Vector2.new(2500 / RootPosition.Z, HeadPosition.Y - LegPosition.Y)
                    BOXPLAYER.Position = Vector2.new(RootPosition.X - BOXPLAYER.Size.X / 2, RootPosition.Y - BOXPLAYER.Size.Y / 2)
                    BOXPLAYER.Visible = taffy_esp.box.enabled

                    if not taffy_esp.misc.useteamcolors then
                        local color = v.TeamColor
                        BOXPLAYER.Color = taffy_esp.box.color1
                    else
                        BOXPLAYER.Color = taffy_esp.box.color1
                    end

                    HealthBarOUTLINE.Size = Vector2.new(2, HeadPosition.Y - LegPosition.Y)
                    HealthBarOUTLINE.Position = HealthBarOUTLINE.Position - Vector2.new(6, 0)
                    HealthBarOUTLINE.Visible = taffy_esp.box.outline
                    HealthBarITSELF.Size = Vector2.new(2, (HeadPosition.Y - LegPosition.Y) / (v.Character.Humanoid.MaxHealth / math.clamp(v.Character.Humanoid.Health, 0, v.Character.Humanoid.MaxHealth)))
                    HealthBarITSELF.Position = Vector2.new(BOXPLAYER.Position.X - 5, BOXPLAYER.Position.Y + (1 / HealthBarITSELF.Size.Y))
                    HealthBarITSELF.Color = taffy_esp.box.healthbarcolor
                    HealthBarITSELF.Visible = taffy_esp.box.healthbar
                else
                    BLOCKOUTLINE.Visible = false
                    BOXPLAYER.Visible = false
                    HealthBarOUTLINE.Visible = false
                    HealthBarITSELF.Visible = false
                end

                if taffy_esp.tracer.enabled then
                    if taffy_esp.tracer.unlocktracers then
                        Tracer.From = Vector2.new(mouse.X, mouse.Y + 36)
                    else
                        Tracer.From = Vector2.new(CurrentCamera.ViewportSize.X / 2, CurrentCamera.ViewportSize.Y / 1)
                    end

                    Tracer.To = Vector2.new(Vector.X, Vector.Y)
                    Tracer.Visible = taffy_esp.tracer.enabled

                    if not taffy_esp.misc.useteamcolors then
                        local color = v.TeamColor
                        Tracer.Color = taffy_esp.tracer.color
                    else
                        Tracer.Color = taffy_esp.tracer.color
                    end
                else
                    Tracer.Visible = false
                end

                if taffy_esp.Toolsshow.enable then
                    local Equipped = v.Character:FindFirstChildOfClass("Tool") and v.Character:FindFirstChildOfClass("Tool").Name or "None"
                    toolshow.Text = Equipped
                    toolshow.Position = Vector2.new(CurrentCamera:WorldToViewportPoint(v.Character.Head.Position).X, CurrentCamera:WorldToViewportPoint(v.Character.Head.Position).Y + 30)
                    toolshow.Color = getgenv().taffy_esp.Toolsshow.color
                    toolshow.Font = 3
                    Name.Size = taffy_esp.Toolsshow.size
                    toolshow.Visible = true
                else
                    toolshow.Visible = false
                end

                if taffy_esp.name.enabled then
                    Name.Text = tostring(v.Character.Humanoid.DisplayName) .. " [" .. tostring(math.floor(v.Character.Humanoid.Health + 0.5)) .. "/" .. tostring(v.Character.Humanoid.MaxHealth) .. "]"
                    Name.Position = Vector2.new(CurrentCamera:WorldToViewportPoint(v.Character.Head.Position).X, CurrentCamera:WorldToViewportPoint(v.Character.Head.Position).Y - 30)
                    Name.Visible = true
                    Name.Size = taffy_esp.name.size

                    if not taffy_esp.misc.useteamcolors then
                        local color = v.TeamColor   
                        Name.Color = taffy_esp.name.color
                    else
                        Name.Color = taffy_esp.name.color
                    end

                    Name.Outline = taffy_esp.name.outline
                else
                    Name.Visible = false
                end
            else
                BLOCKOUTLINE.Visible = false
                BOXPLAYER.Visible = false
                toolshow.Visible = false
                HealthBarOUTLINE.Visible = false
                HealthBarITSELF.Visible = false
                Tracer.Visible = false
                Name.Visible = false
            end
        else
            toolshow.Visible = false
            BLOCKOUTLINE.Visible = false
            BOXPLAYER.Visible = false
            HealthBarOUTLINE.Visible = false
            HealthBarITSELF.Visible = false
            Tracer.Visible = false
            Name.Visible = false
        end
    end)
end

for i, v in pairs(game.Players:GetChildren()) do
    esp(v)
end

game.Players.PlayerAdded:Connect(function(v)
    esp(v)
end)

--// Create the  main window
local Window = Library:CreateWindow({
    Title = "Universal Aimbot and Esp made by Linemaster",
    Center = true,
    AutoShow = true,
})

--// Create the main tabs
local Tabs = {
    Aiming = Window:AddTab("Aiming"),
    Visuals = Window:AddTab("Visuals"),
    MiscTab = Window:AddTab("Misc"),
    UiSettings = Window:AddTab("Settings")
}

--// Sections
local AimbotTab = Tabs.Aiming:AddLeftGroupbox("Aimbot")
local EspTab = Tabs.Visuals:AddLeftGroupbox("Esp")
local LightTab = Tabs.Visuals:AddRightGroupbox("Light")
local AspectRatioTab = Tabs.Visuals:AddLeftGroupbox("Aspect Ratio")
local NameTagTab = Tabs.Visuals:AddRightGroupbox("Nametag")
local CloneChamsTab = Tabs.Visuals:AddRightGroupbox("Clone Chams")
local WorldTab = Tabs.Visuals:AddLeftGroupbox("World")
local MessageSpammer = Tabs.MiscTab:AddLeftGroupbox("Chat Spammer")
local FakeAnimations = Tabs.MiscTab:AddLeftGroupbox("Fake Animations")
local CFrameSpeedTab = Tabs.MiscTab:AddRightGroupbox("CFrame Speed")
local FlyTab = Tabs.MiscTab:AddRightGroupbox("Fly")
local MenuGroup = Tabs.UiSettings:AddLeftGroupbox("Config")

--// Toggles and shit
AimbotTab:AddToggle("AimbotEnabledFunny", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Aimbot Enabled",
})

Toggles.AimbotEnabledFunny:OnChanged(function()
    Settings.Aimbot.Enabled = Toggles.AimbotEnabledFunny.Value
end)

AimbotTab:AddToggle("AimbotStickyAimFunny", {
    Text = "Sticky Aim",
    Default = false,
    Tooltip = "Sticky Aim Enabled",
})

Toggles.AimbotStickyAimFunny:OnChanged(function()
    Settings.Aimbot.Stickyaim = Toggles.AimbotStickyAimFunny.Value
end)

Toggles.AimbotStickyAimFunny:AddKeyPicker("AimbotKeyPickerFunny", {
    Default = "None",
    SyncToggleState = false,
    Mode = "Toggle",
    Text = "Aimbot",
    NoUI = false,
})

Options.AimbotKeyPickerFunny:OnClick(function()
    if Settings.Aimbot.Enabled and Settings.Aimbot.Stickyaim then
        aimbotkeybind = not aimbotkeybind

        if aimbotkeybind then
            stickyLockedPlayer  = aimbotGetClosestPlayer()

            if stickyLockedPlayer  and Settings.Aimbot.Alerts then
                Library:Notify("Locked onto: " .. tostring(stickyLockedPlayer.Character.Humanoid.DisplayName))
            end
        elseif not aimbotkeybind then
            if stickyLockedPlayer  and Settings.Aimbot.Alerts then
                Library:Notify("Unlocked")
            end
            stickyLockedPlayer  = nil
        end
    end
end)

AimbotTab:AddToggle("AimbotTeamcheckFunny", {
    Text = "Teamcheck",
    Default = false,
    Tooltip = "Teamcheck Enabled",
})

Toggles.AimbotTeamcheckFunny:OnChanged(function()
    Settings.Aimbot.Teamcheck = Toggles.AimbotTeamcheckFunny.Value
end)

AimbotTab:AddToggle("AimbotAlivecheckFunny", {
    Text = "Alivecheck",
    Default = false,
    Tooltip = "Alivecheck Enabled",
})

Toggles.AimbotAlivecheckFunny:OnChanged(function()
    Settings.Aimbot.Alivecheck = Toggles.AimbotAlivecheckFunny.Value
end)

AimbotTab:AddToggle("AimbotDistancecheckToggleFunny", {
    Text = "Distance Check",
    Default = false,
    Tooltip = "Distance Check Enabled",
})

Toggles.AimbotDistancecheckToggleFunny:OnChanged(function()
    Settings.Aimbot.Distancecheck.Enabled = Toggles.AimbotDistancecheckToggleFunny.Value
end)

AimbotTab:AddSlider("AimbotDistancecheckSliderFunny", {
    Text = "Distance",
    Default = 100,
    Min = 10,
    Max = 100000,
    Rounding = 1,
    Compact = false,
})

Options.AimbotDistancecheckSliderFunny:OnChanged(function()
    Settings.Aimbot.Distancecheck.Value = Options.AimbotDistancecheckSliderFunny.Value
end)

AimbotTab:AddToggle("AimbotAlertsToggleFunny", {
    Text = "Alerts",
    Default = false,
    Tooltip = "Alerts Enabled",
})

Toggles.AimbotAlertsToggleFunny:OnChanged(function()
    Settings.Aimbot.Alerts = Toggles.AimbotAlertsToggleFunny.Value
end)


AimbotTab:AddDropdown("ModeCheckThingYk", {
    Values = {"First Person", "Third Person"},
    Default = 1,
    Multi = false,
    Text = "Mode",
})

Options.ModeCheckThingYk:OnChanged(function()
    Settings.Aimbot.Mode = Options.ModeCheckThingYk.Value
end)

AimbotTab:AddDropdown("PartToAimOnFunnyHaha", {
    Values = {"Head", "HumanoidRootPart"},
    Default = 1,
    Multi = false,
    Text = "AimPart",
})

Options.PartToAimOnFunnyHaha:OnChanged(function()
    Settings.Aimbot.Aimpart = Options.PartToAimOnFunnyHaha.Value
end)

AimbotTab:AddDropdown("KeytoAimDropdown", {
    Values = {"RMB", "LMB"},
    Default = 2,
    Multi = false,
    Text = "Key",
})

Options.KeytoAimDropdown:OnChanged(function()
    Settings.Aimbot.Aimkey = Options.KeytoAimDropdown.Value
end)

AimbotTab:AddToggle("PredToggleFunny", {
    Text = "Use Prediction",
    Default = false,
    Tooltip = "Prediction Enabled",
})

Toggles.PredToggleFunny:OnChanged(function()
    Settings.Aimbot.Prediction.Enabled = Toggles.PredToggleFunny.Value
end)

AimbotTab:AddInput("PredictionValueTextBoxFunny", {
    Default = "0.135",
    Numeric = true,
    Finished = false,
    Text = "Prediction",
    Tooltip = "Prediction to Use",
    Placeholder = "Example = 0.135",
})

Options.PredictionValueTextBoxFunny:OnChanged(function()
    Settings.Aimbot.Prediction.PredValue = Options.PredictionValueTextBoxFunny.Value
end)

AimbotTab:AddToggle("ShakeEnabledOwO", {
    Text = "Use Shake",
    Default = false,
    Tooltip = "Shake Enabled",
})

Toggles.ShakeEnabledOwO:OnChanged(function()
    Settings.Aimbot.Shake.Enabled = Toggles.ShakeEnabledOwO.Value
end)

AimbotTab:AddSlider("ShakeValueOwO", {
    Text = "Shake Value",
    Default = 0.1,
    Min = 0.1,
    Max = 10,
    Rounding = 1,
    Compact = false,
})

Options.ShakeValueOwO:OnChanged(function()
    Settings.Aimbot.Shake.ShakeValue = Options.ShakeValueOwO.Value
end)


AimbotTab:AddToggle("UseFovAimbotFunny", {
    Text = "Use fov",
    Default = false,
    Tooltip = "Fov Enabled",
})

Toggles.UseFovAimbotFunny:OnChanged(function()
    Settings.Aimbot.Fov.Enabled = Toggles.UseFovAimbotFunny.Value
end)

Toggles.UseFovAimbotFunny:AddColorPicker("FovCircleColorFunny", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Aimbot FOV Color"
})

Options.FovCircleColorFunny:OnChanged(function()
    Settings.Aimbot.Fov.Color = Options.FovCircleColorFunny.Value
end)

AimbotTab:AddSlider("FovCircleRadius", {
    Text = "Radius",
    Default = 100,
    Min = 100,
    Max = 800,
    Rounding = 1,
    Compact = false,
})

Options.FovCircleRadius:OnChanged(function()
    Settings.Aimbot.Fov.Radius = Options.FovCircleRadius.Value
end)

AimbotTab:AddToggle("ToggleSmoothnessNoWay", {
    Text = "Smoothing Enabled",
    Default = false,
    Tooltip = "Smoothing Enabled",
})

Toggles.ToggleSmoothnessNoWay:OnChanged(function()
    Settings.Aimbot.Smoothness.Enabled = Toggles.ToggleSmoothnessNoWay.Value
end)


AimbotTab:AddSlider("SmoothnessValueAimbotOwO", {
    Text = "Smoothness",
    Default = 0,
    Min = 0,
    Max = 1,
    Rounding = 2,
    Compact = false,
})

Options.SmoothnessValueAimbotOwO:OnChanged(function()
    Settings.Aimbot.Smoothness.SmoothnessValue = Options.SmoothnessValueAimbotOwO.Value
end)

EspTab:AddToggle("BoxesEnableToggleNoWay", {
    Text = "Boxes",
    Default = false,
    Tooltip = "Boxes Enabled",
})

Toggles.BoxesEnableToggleNoWay:OnChanged(function()
    taffy_esp.box.enabled = Toggles.BoxesEnableToggleNoWay.Value
end)

Toggles.BoxesEnableToggleNoWay:AddColorPicker("BoxesEnableColorPickerNoWay", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Boxes Color"
})

Options.BoxesEnableColorPickerNoWay:OnChanged(function()
    taffy_esp.box.color1 = Options.BoxesEnableColorPickerNoWay.Value
end)

EspTab:AddToggle("NamesEnableToggleNoWay", {
    Text = "Names",
    Default = false,
    Tooltip = "Names Enabled",
})

Toggles.NamesEnableToggleNoWay:OnChanged(function()
    taffy_esp.name.enabled = Toggles.NamesEnableToggleNoWay.Value
end)

Toggles.NamesEnableToggleNoWay:AddColorPicker("NamesEnableColorPickerNoWay", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Names Color"
})

Options.NamesEnableColorPickerNoWay:OnChanged(function()
    taffy_esp.name.color = Options.NamesEnableColorPickerNoWay.Value
end)

EspTab:AddToggle("TracersEnableToggleNoWay", {
    Text = "Tracers",
    Default = false,
    Tooltip = "Tracers Enabled",
})

Toggles.TracersEnableToggleNoWay:OnChanged(function()
    taffy_esp.tracer.enabled = Toggles.TracersEnableToggleNoWay.Value
end)

Toggles.TracersEnableToggleNoWay:AddColorPicker("TracersEnableColorPickerNoWay", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Tracers Color"
})

Options.TracersEnableColorPickerNoWay:OnChanged(function()
    taffy_esp.tracer.color = Options.TracersEnableColorPickerNoWay.Value
end)

EspTab:AddToggle("UnlockTracersEnableToggleNoWay", {
    Text = "Unlock Tracers",
    Default = false,
    Tooltip = "Unlock Tracers Enabled",
})

Toggles.UnlockTracersEnableToggleNoWay:OnChanged(function()
    taffy_esp.tracer.unlocktracers = Toggles.UnlockTracersEnableToggleNoWay.Value
end)

EspTab:AddToggle("MiscTeamcheckToggle", {
    Text = "Teamcheck",
    Default = false,
    Tooltip = "Teamcheck Enabled",
})

Toggles.MiscTeamcheckToggle:OnChanged(function()
    taffy_esp.misc.teamcheck = Toggles.MiscTeamcheckToggle.Value
end)

LightTab:AddToggle("LightHeadToggleFunny", {
    Text = "Light",
    Default = false,
    Tooltip = "Light Enabled",
})

Toggles.LightHeadToggleFunny:OnChanged(function()
    Settings.Visuals.Local.Light.Enabled = Toggles.LightHeadToggleFunny.Value
end)

Toggles.LightHeadToggleFunny:AddColorPicker("LightHeadFunnyColorPicker", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Light Color"
})

Options.LightHeadFunnyColorPicker:OnChanged(function()
    Settings.Visuals.Local.Light.Color = Options.LightHeadFunnyColorPicker.Value
end)

LightTab:AddSlider("LightHeadSliderFunny", {
    Text = "Strength",
    Default = 1,
    Min = 1,
    Max = 100,
    Rounding = 1,
    Compact = false,
})

Options.LightHeadSliderFunny:OnChanged(function()
    Settings.Visuals.Local.Light.Strength = Options.LightHeadSliderFunny.Value
end)

AspectRatioTab:AddToggle("AspectRaioEnabled", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Aspect Ratio Enabled",
})

Toggles.AspectRaioEnabled:OnChanged(function()
    Settings.Visuals.Local.AspectRatio.Enabled = Toggles.AspectRaioEnabled.Value
end)

AspectRatioTab:AddSlider("AspectRatioValue", {
    Text = "Value",
    Default = 1,
    Min = 0.1,
    Max = 1,
    Rounding = 2,
    Compact = false,
})


Options.AspectRatioValue:OnChanged(function()
    Settings.Visuals.Local.AspectRatio.Value = Options.AspectRatioValue.Value
end)

NameTagTab:AddToggle("NametagEnabledFunnyHaha", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Nametag Enabled",
})

Toggles.NametagEnabledFunnyHaha:OnChanged(function()
    Settings.Visuals.Local.Nametag.Enabled = Toggles.NametagEnabledFunnyHaha.Value
end)

Toggles.NametagEnabledFunnyHaha:AddColorPicker("NametagColorPickerFunny", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Nametag Color"
})

Options.NametagColorPickerFunny:OnChanged(function()
    Settings.Visuals.Local.Nametag.Color = Options.NametagColorPickerFunny.Value
end)

CloneChamsTab:AddToggle("CloneChamsEnabled", {
    Text = "Clone Chams",
    Default = false,
    Tooltip = "Clone Chams Enabled",
})

Toggles.CloneChamsEnabled:OnChanged(function()
    Settings.Visuals.Local.CloneChams.Enabled = Toggles.CloneChamsEnabled.Value
end)

Toggles.CloneChamsEnabled:AddColorPicker("CloneChamsColor", {
    Default = Color3.fromRGB(255, 255, 255),
    Title = "Clone Chams Color"
})

Options.CloneChamsColor:OnChanged(function()
    Settings.Visuals.Local.CloneChams.Color = Options.CloneChamsColor.Value
end)

local function getEnumMaterial(materialString)
    local materialMap = {
        ["Neon"] = Enum.Material.Neon,
        ["ForceField"] = Enum.Material.ForceField,
        ["Plastic"] = Enum.Material.Plastic,
    }
    return materialMap[materialString] or Enum.Material.Neon
end

task.spawn(function()
    while true do
        wait()
        if Settings.Visuals.Local.CloneChams.Enabled then
            repeat
                lplr.Character.Archivable = true
                local Clone = lplr.Character:Clone()
                for _, Obj in next, Clone:GetDescendants() do
                    if Obj.Name == "HumanoidRootPart" or Obj:IsA("Humanoid") or Obj:IsA("LocalScript") or Obj:IsA("Script") or Obj:IsA("Decal") then
                        Obj:Destroy()
                    elseif Obj:IsA("BasePart") or Obj:IsA("MeshPart") or Obj:IsA("Part") then
                        if Obj.Transparency == 1 then
                            Obj:Destroy()
                        else
                            Obj.CanCollide = false
                            Obj.Anchored = true
                            Obj.Material = getEnumMaterial(Settings.Visuals.Local.CloneChams.Material)

                            Obj.Color = Settings.Visuals.Local.CloneChams.Color
                            Obj.Transparency = 0
                            Obj.Size = Obj.Size + Vector3.new(0.03, 0.03, 0.03)
                        end
                    end
                end

                Clone.Parent = workspace
                wait(Settings.Visuals.Local.CloneChams.Duration)
                Clone:Destroy()
            until not Settings.Visuals.Local.CloneChams.Enabled
        end
    end
end)

CloneChamsTab:AddSlider("DurationSliderWHAT", {
    Text = "Duration",
    Default = 0.1,
    Min = 0.1,
    Max = 3,
    Rounding = 2,
    Compact = false,
})

Options.DurationSliderWHAT:OnChanged(function()
    Settings.Visuals.Local.CloneChams.Duration = Options.DurationSliderWHAT.Value
end)

CloneChamsTab:AddDropdown("CloneChamsMaterial", {
    Values = {"Neon", "ForceField", "Plastic"},
    Default = 2,
    Multi = false,
    Text = "Clone Chams Material",
    Tooltip = "Clone Chams Material",
})

Options.CloneChamsMaterial:OnChanged(function()
    Settings.Visuals.Local.CloneChams.Material = Options.CloneChamsMaterial.Value
end)

WorldTab:AddLabel("Ambient"):AddColorPicker("AmbientColorPicker", {
    Default = Color3.fromRGB(0, 0, 0),
    Title = "Ambient",
})

Options.AmbientColorPicker:OnChanged(function()
    if AmbientRainbowMode == true then
    else
        game.Lighting.Ambient = Options.AmbientColorPicker.Value
    end
end)

WorldTab:AddToggle("RainbowAmbient", {
    Text = "Rainbow Ambient",
    Default = false,
    Tooltip = "Rainbow Ambient Enabled",
})

Toggles.RainbowAmbient:OnChanged(function()
    AmbientRainbowMode = Toggles.RainbowAmbient.Value

    if Toggles.RainbowAmbient.Value then
        while Toggles.RainbowAmbient.Value do
            wait()
            game:GetService("Lighting").Ambient = Color3.new(255 / 255, 0 / 255, 0 / 255)

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(255 / 255, i / 255, 0 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(i / 255, 255 / 255, 0 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(0 / 255, 255 / 255, i / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(0 / 255, i / 255, 255 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(i / 255, 0 / 255, 255 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").Ambient = Color3.new(255 / 255, 0 / 255, i / 255)
            end

            if Toggles.RainbowAmbient.Value == false then break end
        end
    end
end)

local AmbientReset = WorldTab:AddButton("Reset to Default", function()
    Options.AmbientColorPicker:SetValueRGB(Color3.fromRGB(0, 0, 0))
end)

Options.AmbientColorPicker:SetValueRGB(Color3.fromRGB(0, 0, 0))

WorldTab:AddLabel("Outdoor Ambient"):AddColorPicker("OutdoorAmbientColor", {
    Default = Color3.fromRGB(152, 152, 146),
    Title = "Outdoor Ambient",
})

Options.OutdoorAmbientColor:OnChanged(function()
    if OutdoorAmbientRainbowMode then
    else
        game.Lighting.OutdoorAmbient = Options.OutdoorAmbientColor.Value
    end
end)

WorldTab:AddToggle("RainbowOutdoorAmbient", {
    Text = "Rainbow Outdoor",
    Default = false,
    Tooltip = "Rainbow Outdoor Ambient Enabled",
})

Toggles.RainbowOutdoorAmbient:OnChanged(function()
    OutdoorAmbientRainbowMode = Toggles.RainbowOutdoorAmbient.Value

    if Toggles.RainbowOutdoorAmbient.Value then
        while Toggles.RainbowOutdoorAmbient.Value do
            wait()
            game:GetService("Lighting").OutdoorAmbient = Color3.new(255 / 255, 0 / 255, 0 / 255)

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(255 / 255, i / 255, 0 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(i / 255, 255 / 255, 0 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(0 / 255, 255 / 255, i / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(0 / 255, i / 255, 255 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(i / 255, 0 / 255, 255 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").OutdoorAmbient = Color3.new(255 / 255, 0 / 255, i / 255)
            end

            if Toggles.RainbowOutdoorAmbient.Value == false then break end
        end
    end
end)

local OutdoorAmbientReset = WorldTab:AddButton("Reset to Default", function()
    Options.OutdoorAmbientColor:SetValueRGB(Color3.fromRGB(152, 152, 146))
end)

Options.OutdoorAmbientColor:SetValueRGB(Color3.fromRGB(152, 152, 146))

WorldTab:AddSlider("FogEndSlider", {
    Text = "Fog End",
    Default = 500,
    Min = 1,
    Max = 500,
    Rounding = 1,
    Compact = false,
})

Options.FogEndSlider:OnChanged(function()
    game.Lighting.FogEnd = Options.FogEndSlider.Value
end)

WorldTab:AddLabel("Fog Color"):AddColorPicker("FogColorColorPicker", {
    Default = Color3.fromRGB(100, 87, 72),
    Title = "Fog Color",
})

Options.FogColorColorPicker:OnChanged(function()
    if FogRainbowMode then
    else
        game.Lighting.FogColor = Options.FogColorColorPicker.Value
    end
end)

WorldTab:AddToggle("RainbowFogColor", {
    Text = "Rainbow Outdoor",
    Default = false,
    Tooltip = "Rainbow Outdoor Ambient Enabled",
})

Toggles.RainbowFogColor:OnChanged(function()
    FogRainbowMode = Toggles.RainbowFogColor.Value

    if Toggles.RainbowFogColor.Value then
        while Toggles.RainbowFogColor.Value do
            wait()
            game:GetService("Lighting").FogColor = Color3.new(255 / 255, 0 / 255, 0 / 255)

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(255 / 255, i / 255, 0 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(i / 255, 255 / 255, 0 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(0 / 255, 255 / 255, i / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(0 / 255, i / 255, 255 / 255)
            end

            for i = 0, 255, 10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(i / 255, 0 / 255, 255 / 255)
            end

            for i = 255, 0, -10 do
                wait()
                game:GetService("Lighting").FogColor = Color3.new(255 / 255, 0 / 255, i / 255)
            end

            if Toggles.RainbowFogColor.Value == false then break end
        end
    end
end)

local ResetFogEnd = WorldTab:AddButton("Reset to Default", function()
    Options.FogEndSlider:SetValue(500)
    Options.FogColorColorPicker:SetValueRGB(Color3.fromRGB(100, 87, 72))
end)

WorldTab:AddToggle("GlobalShadowsEnabled", {
    Text = "Global Shadows",
    Default = true,
    Tooltip = "Global Shadows Enabled",
})

Toggles.GlobalShadowsEnabled:OnChanged(function()
    game.Lighting.GlobalShadows = Toggles.GlobalShadowsEnabled.Value
end)

WorldTab:AddSlider("Saturation", {
    Text = "Saturation",
    Default = 0,
    Min = 0,
    Max = 10,
    Rounding = 1,
    Compact = false,
})

Options.Saturation:OnChanged(function()
    local ColorCorrection = game.Lighting:FindFirstChildOfClass("ColorCorrectionEffect") or Instance.new("ColorCorrectionEffect")
    ColorCorrection.Saturation = Options.Saturation.Value
end)

WorldTab:AddSlider("Contrast", {
    Text = "Contrast",
    Default = 0.1,
    Min = 0,
    Max = 10,
    Rounding = 1,
    Compact = false,
})

Options.Contrast:OnChanged(function()
    local ColorCorrection = game.Lighting:FindFirstChildOfClass("ColorCorrectionEffect") or Instance.new("ColorCorrectionEffect")
    ColorCorrection.Contrast = Options.Contrast.Value
end)

MessageSpammer:AddToggle("EnableMessageSpammerLo", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Message Spammer Enabled",
})

Toggles.EnableMessageSpammerLo:OnChanged(function()
    Settings.Blatant.MessageSpammer.Enabled = Toggles.EnableMessageSpammerLo.Value
end)

MessageSpammer:AddToggle("EnableMessageSpammerEmojisLo", {
    Text = "Use Emojis",
    Default = false,
    Tooltip = "Use Emojis Enabled",
})

Toggles.EnableMessageSpammerEmojisLo:OnChanged(function()
    Settings.Blatant.MessageSpammer.UseEmojis = Toggles.EnableMessageSpammerEmojisLo.Value
end)

MessageSpammer:AddInput("MessageSpammerMessagetoSpamLo", {
    Default = "",
    Numeric = false,
    Finished = false,
    Text = "Message",
    Tooltip = "Message to Spam",
    Placeholder = "Example1, Example2",
})

Options.MessageSpammerMessagetoSpamLo:OnChanged(function()
    Settings.Blatant.MessageSpammer.Message = Options.MessageSpammerMessagetoSpamLo.Value
end)

FakeAnimations:AddDropdown("RunAnimations", {
    Values = {"None", "Rthro", "Werewolf", "Zombie", "Ninja", "Toy", "Superhero", "OldSchool", "Cartoony", "Stylish", "Vampire"},
    Default = 1,
    Multi = false,
    Text = "Run",
})

Options.RunAnimations:OnChanged(function()
    ChangeAnimHook = game:GetService("RunService").Stepped:Connect(function()
        if Options.RunAnimations.Value == "None" then
        elseif Options.RunAnimations.Value == "Rthro" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=2510198475"
        elseif Options.RunAnimations.Value == "Werewolf" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=1083216690"
        elseif Options.RunAnimations.Value == "Zombie" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616163682"
        elseif Options.RunAnimations.Value == "Ninja" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=656118852"
        elseif Options.RunAnimations.Value == "Toy" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=782842708"
        elseif Options.RunAnimations.Value == "Superhero" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616117076"
        elseif Options.RunAnimations.Value == "OldSchool" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=5319844329"
        elseif Options.RunAnimations.Value == "Cartoony" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=742638842"
        elseif Options.RunAnimations.Value == "Stylish" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616140816"
        elseif Options.RunAnimations.Value == "Vampire" then
            lplr.Character.Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=1083462077"
        end
    end)
end)

FakeAnimations:AddDropdown("JumpAnimations", {
    Values = {"None", "Rthro", "Werewolf", "Zombie", "Ninja", "Toy", "Superhero", "OldSchool", "Cartoony", "Stylish", "Vampire"},
    Default = 1,
    Multi = false,
    Text = "Jump",
})

Options.JumpAnimations:OnChanged(function()
    ChangeJumpAnimHook = game:GetService("RunService").Stepped:Connect(function()
        if Options.JumpAnimations.Value == "None" then
        elseif Options.JumpAnimations.Value == "Rthro" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=2510197830"
        elseif Options.JumpAnimations.Value == "Werewolf" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=1083218792"
        elseif Options.JumpAnimations.Value == "Zombie" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=616161997"
        elseif Options.JumpAnimations.Value == "Ninja" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=656117878"
        elseif Options.JumpAnimations.Value == "Toy" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=782847020"
        elseif Options.JumpAnimations.Value == "Superhero" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=616115533"
        elseif Options.JumpAnimations.Value == "OldSchool" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=5319841935"
        elseif Options.JumpAnimations.Value == "Cartoony" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=742637942"
        elseif Options.JumpAnimations.Value == "Stylish" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=616139451"
        elseif Options.JumpAnimations.Value == "Vampire" then
            lplr.Character.Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=1083455352"
        end
    end)
end)

FakeAnimations:AddDropdown("FallAnimations", {
    Values = {"None", "Rthro", "Werewolf", "Zombie", "Ninja", "Toy", "Superhero", "OldSchool", "Cartoony", "Stylish", "Vampire"},
    Default = 1,
    Multi = false,
    Text = "Fall",
})

Options.FallAnimations:OnChanged(function()
    ChangeFallAnimHook = game:GetService("RunService").Stepped:Connect(function()
        if Options.FallAnimations.Value == "None" then
        elseif Options.FallAnimations.Value == "Rthro" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=2510195892"
        elseif Options.FallAnimations.Value == "Werewolf" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=1083189019"
        elseif Options.FallAnimations.Value == "Zombie" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=616157476"
        elseif Options.FallAnimations.Value == "Ninja" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=656115606"
        elseif Options.FallAnimations.Value == "Toy" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=782846423"
        elseif Options.FallAnimations.Value == "Superhero" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=616115533"
        elseif Options.FallAnimations.Value == "OldSchool" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=5319839762"
        elseif Options.FallAnimations.Value == "Cartoony" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=742640026"
        elseif Options.FallAnimations.Value == "Stylish" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=616134815"
        elseif Options.FallAnimations.Value == "Vampire" then
            lplr.Character.Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=1083443587"
        end
    end)
end)

CFrameSpeedTab:AddToggle("CFrameSpeedToggleFunny", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Enable CFrame Speed",
})

Toggles.CFrameSpeedToggleFunny:OnChanged(function()
    Settings.Blatant.CFrameSpeed.Enabled = Toggles.CFrameSpeedToggleFunny.Value
end)

Toggles.CFrameSpeedToggleFunny:AddKeyPicker("CFrameSpeedKeyBind", {
    Default = "None",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "CFrame",
    NoUI = false,
})

CFrameSpeedTab:AddSlider("CFrameSpeedValue", {
    Text = "CFrame Speed Amount",
    Default = 1,
    Min = 1,
    Max = 5,
    Rounding = 2,
    Compact = false,
})

Options.CFrameSpeedValue:OnChanged(function()
    Settings.Blatant.CFrameSpeed.Value = Options.CFrameSpeedValue.Value
end)

FlyTab:AddToggle("FlyToggleFunny", {
    Text = "Enabled",
    Default = false,
    Tooltip = "Fly Enabled",
})

Toggles.FlyToggleFunny:OnChanged(function()
    if Toggles.FlyToggleFunny.Value == true then
        FlyLoop = game:GetService("RunService").RenderStepped:Connect(function()
            spawn(function()
                pcall(function()
                    local speed = Settings.Blatant.Fly.Value
                    local velocity = Vector3.new(0, 0, 0)
                    local UserInputService = game:GetService("UserInputService")
                    local flyUpwards = UserInputService:IsKeyDown(Enum.KeyCode.Space)
                    local flyDownwards = UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) 
                    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                        velocity = velocity + (CurrentCamera.CoordinateFrame.lookVector * speed)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                        velocity = velocity + (CurrentCamera.CoordinateFrame.rightVector * -speed)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                        velocity = velocity + (CurrentCamera.CoordinateFrame.lookVector * -speed)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                        velocity = velocity + (CurrentCamera.CoordinateFrame.rightVector * speed)
                    end

                    if flyUpwards then
                        velocity = velocity + (Vector3.new(0, 1, 0) * speed)
                    end
                    if flyDownwards then
                        velocity = velocity + (Vector3.new(0, -1, 0) * speed)
                    end
                    lplr.Character.HumanoidRootPart.Velocity = velocity
                    lplr.Character.Humanoid:ChangeState("Freefall")
                end)
            end)
        end)
    elseif Toggles.FlyToggleFunny.Value == false and FlyLoop then
        FlyLoop:Disconnect()
        lplr.Character.Humanoid:ChangeState("Landing")
    end
end)

Toggles.FlyToggleFunny:AddKeyPicker("FlyKeyBind", {
    Default = "None",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Fly",
    NoUI = false,
})

FlyTab:AddSlider("FlyValue", {
    Text =  "Fly Amount",
    Default = 1,
    Min = 1,
    Max = 5,
    Rounding = 2,
    Compact = false,
})

Options.FlyValue:OnChanged(function()
    Settings.Blatant.Fly.Value = Options.FlyValue.Value * 30
end)


--// Light head funny thing
game:GetService("RunService").RenderStepped:Connect(function()
    if Settings.Visuals.Local.Light.Enabled then
        local player = game.Players.LocalPlayer
        local head = player.Character.Head
        local light = head:FindFirstChild("HeadLight")
        if not light then
            light = Instance.new("PointLight")
            light.Name = "HeadLight"
            light.Range = 20
            light.Parent = head
        end

        light.Brightness = Settings.Visuals.Local.Light.Strength
        light.Color = Settings.Visuals.Local.Light.Color
    else
        local player = game.Players.LocalPlayer
        local head = player.Character.Head
        local light = head:FindFirstChild("HeadLight")
        if light then
            light:Destroy()
        end
    end
end)

--// Nametag Funny thing
game:GetService("RunService").RenderStepped:Connect(function()
    if Settings.Visuals.Local.Nametag.Enabled then
        local player = game.Players.LocalPlayer
        local character = player.Character
        local head = character and character:FindFirstChild("Head")
        local billboard = head and head:FindFirstChild("NametagBillboard")
        
        if not billboard then
            billboard = Instance.new("BillboardGui")
            billboard.Name = "NametagBillboard"
            billboard.Size = UDim2.new(0, 100, 0, 50)
            billboard.StudsOffset = Vector3.new(0, 2, 0) 
            
            local textLabel = Instance.new("TextLabel")
            textLabel.Name = "NametagText"
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.BackgroundTransparency = 1
            textLabel.TextColor3 = Settings.Visuals.Local.Nametag.Color
            textLabel.Text = "   " .. player.Name .. "\n     |\n     |\n     V"
            textLabel.Font = Enum.Font.SourceSansBold
            textLabel.TextSize = 20
            textLabel.TextYAlignment = Enum.TextYAlignment.Top
            textLabel.TextTransparency = 0 
            textLabel.Parent = billboard
            billboard.Parent = head
        end

        local nametagText = billboard:FindFirstChild("NametagText")
        if nametagText then
            nametagText.TextColor3 = Settings.Visuals.Local.Nametag.Color
        end
    else
        local player = game.Players.LocalPlayer
        local character = player.Character
        local head = character and character:FindFirstChild("Head")
        local billboard = head and head:FindFirstChild("NametagBillboard")
        
        if billboard then
            billboard:Destroy()
        end
    end
end)

--// Create the fov circle
local FOVring = Drawing.new("Circle")
FOVring.Visible = Settings.Aimbot.Fov.Enabled
FOVring.Thickness = 1.5
FOVring.Radius = Settings.Aimbot.Fov.Radius
FOVring.Transparency = 1
FOVring.Color = Settings.Aimbot.Fov.Color
FOVring.Position = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y / 2)

--// Main functions

local function getAimKey()
    if Settings.Aimbot.Aimkey == "LMB" then
        return Enum.UserInputType.MouseButton1
    elseif Settings.Aimbot.Aimkey == "RMB" then
        return Enum.UserInputType.MouseButton2
    end
end

local lockedOnPlayer = nil
local function getMousePosition()
    local mouse = game.Players.LocalPlayer:GetMouse()
    return mouse.X, mouse.Y
end

local function calculateDelta(targetX, targetY, mouseX, mouseY)
    return targetX - mouseX, targetY - mouseY
end

local function applyShake()
    if Settings.Aimbot.Shake.Enabled then
        local shakeOffset = Vector3.new(
            math.random() * Settings.Aimbot.Shake.ShakeValue - Settings.Aimbot.Shake.ShakeValue / 2,
            math.random() * Settings.Aimbot.Shake.ShakeValue - Settings.Aimbot.Shake.ShakeValue / 2,
            math.random() * Settings.Aimbot.Shake.ShakeValue - Settings.Aimbot.Shake.ShakeValue / 2
        )
        workspace.CurrentCamera.CFrame = workspace.CurrentCamera.CFrame * CFrame.new(shakeOffset)
    end
end
local function FOVCHECK(Player)
    if FOVring.Visible == false then
        return true
    end

    local FOVCheck = FOVring.Radius

    if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild("Humanoid") and Player.Character.Humanoid.Health ~= 0 and Player.Character:FindFirstChild("LowerTorso") then
        local pos = CurrentCamera:WorldToViewportPoint(Player.Character.PrimaryPart.Position)
        local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(mouse.X, mouse.Y)).magnitude

        if magnitude < FOVCheck then
            FOVCheck = magnitude
            return true
        else
            return false
        end
    end
end
local function getClosestPlayer()
    local players = game:GetService("Players"):GetPlayers()
    local closestPlayer = nil
    local closestDistance = math.huge

    local mousePos = Vector2.new(getMousePosition())

    local function getDistance(point1, point2)
        return (point1 - point2).Magnitude
    end

    for i, player in pairs(players) do
        if FOVCHECK(player) then
            if player.Character and player.Character:FindFirstChild("Head") and player ~= game:GetService("Players").LocalPlayer then
                local pos, vis = workspace.CurrentCamera:WorldToViewportPoint(player.Character.Head.Position)
                if vis then
                    local ssHeadPoint = Vector2.new(pos.X, pos.Y)
                    local isSameTeam = player.Team == game:GetService("Players").LocalPlayer.Team

                    local distance = getDistance(ssHeadPoint, mousePos)

                    if Settings.Aimbot.Fov.Enabled and distance < Settings.Aimbot.Fov.Radius and (not Settings.Aimbot.Teamcheck or not isSameTeam) then
                        if distance < closestDistance then
                            closestPlayer = player
                            closestDistance = distance
                        end
                    elseif not Settings.Aimbot.Fov.Enabled and (not Settings.Aimbot.Teamcheck or not isSameTeam) then
                        if distance < closestDistance then
                            closestPlayer = player
                            closestDistance = distance
                        end
                    end
                end
            end
        end
    end

    if closestPlayer then
        return closestPlayer
    else
        return nil
    end
end

local currentTween = nil

game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.UserInputType == getAimKey() then
        if currentTween then
            currentTween:Cancel()
            currentTween = nil
        end

        if not Settings.Aimbot.Stickyaim then
            local closestPlayer = getClosestPlayer()
            if closestPlayer then
                lockedPlayer = closestPlayer
            end
        elseif lockedPlayer then
            lockedPlayer = nil
        end
    end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == getAimKey() then
        if currentTween then
            currentTween:Cancel()
            currentTween = nil
        end
        lockedPlayer = nil
    end
end)

local function aimbotLogic()
    if Settings.Aimbot.Mode == "Third Person" then
        FOVring.Position = Vector2.new(getMousePosition())
    else
        FOVring.Position = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y / 2)
    end

    local targetPlayer = Settings.Aimbot.Stickyaim and stickyLockedPlayer or lockedPlayer

    if targetPlayer and Settings.Aimbot.Enabled then
        local cameraPos = workspace.CurrentCamera.CFrame.Position

        if targetPlayer.Character and targetPlayer.Character:FindFirstChild(Settings.Aimbot.Aimpart) then
            local aimPart = targetPlayer.Character:FindFirstChild(Settings.Aimbot.Aimpart)
            local partPos = aimPart.Position
            local velocity = aimPart.Velocity

            if Settings.Aimbot.Prediction.Enabled then
                partPos = partPos + velocity * Vector3.new(Settings.Aimbot.Prediction.PredValue, Settings.Aimbot.Prediction.PredValue, Settings.Aimbot.Prediction.PredValue)
            end

            if Settings.Aimbot.Distancecheck.Enabled then
                local distanceToTarget = (partPos - cameraPos).Magnitude
                if distanceToTarget > Settings.Aimbot.Distancecheck.Value then
                    if Settings.Aimbot.Stickyaim then
                        stickyLockedPlayer = nil
                        if currentTween then
                            currentTween:Cancel()
                            currentTween = nil
                        end
                    else
                        lockedPlayer = nil
                        if currentTween then
                            currentTween:Cancel()
                            currentTween = nil
                        end
                    end
                    return
                end
            end


            local newCameraCFrame = CFrame.new(cameraPos, partPos)

            if currentTween then
                currentTween:Cancel()
                currentTween = nil
            end

            if Settings.Aimbot.Stickyaim then
                aimKey = nil
            else
                aimKey = getAimKey()
            end

            local isAimKeyPressed = aimKey and game:GetService("UserInputService"):IsMouseButtonPressed(aimKey)

            if Settings.Aimbot.Stickyaim and not isAimKeyPressed then
                if Settings.Aimbot.Mode == "Third Person" then
                    local Vector = CurrentCamera:WorldToViewportPoint(partPos)
				    mousemoverel((Vector.X - game:GetService("UserInputService"):GetMouseLocation().X), (Vector.Y - game:GetService("UserInputService"):GetMouseLocation().Y))
                else
                    if Settings.Aimbot.Smoothness.Enabled then
                        currentTween = TweenService:Create(workspace.CurrentCamera, TweenInfo.new(Settings.Aimbot.Smoothness.SmoothnessValue, Enum.EasingStyle.Linear), {
                            CFrame = newCameraCFrame
                        })
                        currentTween:Play()
                    else
                        workspace.CurrentCamera.CFrame = newCameraCFrame
                    end
                end

                applyShake()
                return
            end

            if not Settings.Aimbot.Stickyaim or (Settings.Aimbot.Stickyaim and not isAimKeyPressed) then
                if Settings.Aimbot.Mode == "Third Person" then
                    local Vector = CurrentCamera:WorldToViewportPoint(partPos)
				    mousemoverel((Vector.X - game:GetService("UserInputService"):GetMouseLocation().X), (Vector.Y - game:GetService("UserInputService"):GetMouseLocation().Y))
                else
                    if Settings.Aimbot.Smoothness.Enabled and isAimKeyPressed then
                        currentTween = TweenService:Create(workspace.CurrentCamera, TweenInfo.new(Settings.Aimbot.Smoothness.SmoothnessValue, Enum.EasingStyle.Linear), {
                            CFrame = newCameraCFrame
                        })
                        currentTween:Play()
                    else
                        workspace.CurrentCamera.CFrame = newCameraCFrame
                    end
                end
            end

            applyShake()
        end

        if Settings.Aimbot.Alivecheck and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
            local humanoid = targetPlayer.Character:FindFirstChild("Humanoid")
            if humanoid.Health <= 0 then
                if Settings.Aimbot.Stickyaim then
                    stickyLockedPlayer = nil
                    if currentTween then
                        currentTween:Cancel()
                        currentTween = nil
                    end
                else
                    lockedPlayer = nil
                end
                return
            end
        end
    else
        if Settings.Aimbot.Stickyaim then
            stickyLockedPlayer = nil
            if currentTween then
                currentTween:Cancel()
                currentTween = nil
            end
        else
            lockedPlayer = nil
        end
    end
end

function aimbotGetClosestPlayer()
    local distance = Settings.Aimbot.Fov.Radius
    local zclosest

    for i, v in pairs(game.Players:GetPlayers()) do
        if v ~= lplr and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 and v.Character:FindFirstChild("HumanoidRootPart") then
            local pos = CurrentCamera:WorldToViewportPoint(v.Character.PrimaryPart.Position)
            local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(lplr:GetMouse().X, lplr:GetMouse().Y)).magnitude

            if magnitude < distance then
                zclosest = v
                distance = magnitude
            end
        end
    end

    return zclosest
end

--// Aspect ratio aka stretched res lo
local oldNewindex

oldNewindex = hookmetamethod(game, "__newindex", function(object, propertyName, propertyValue)
    if object == CurrentCamera and propertyName == "CFrame" then
        if Settings.Visuals.Local.AspectRatio.Enabled then
            propertyValue = propertyValue * CFrame.new(0, 0, 0, 1, 0, 0, 0, Settings.Visuals.Local.AspectRatio.Value, 0, 0, 0, 1)
        end
    end
    return oldNewindex(object, propertyName, propertyValue)
end)


--// Renderstepped for aimbot
game:GetService("RunService").RenderStepped:Connect(aimbotLogic)

local emojis = {"", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""}

local Messages = Settings.Blatant.MessageSpammer.Message
local messageList = {}
local currentIndex = 1
local lastMessageTime = tick()

game:GetService("RunService").Heartbeat:Connect(function()
    if Settings.Blatant.MessageSpammer.Enabled then
        local currentTime = tick()
        local elapsedTime = currentTime - lastMessageTime

        if Settings.Blatant.MessageSpammer.Message ~= Messages then
            Messages = Settings.Blatant.MessageSpammer.Message
            messageList = {}

            for message in Messages:gmatch("([^,]+)") do
                table.insert(messageList, message)
            end
        end

        if elapsedTime >= 3 then
            local message = messageList[currentIndex]

            if message then
                sendMessage(message)
                currentIndex = currentIndex + 1

                if currentIndex > #messageList then
                    currentIndex = 1
                end

                lastMessageTime = currentTime
            end
        end
    end
end)

function sendMessage(message)
    local finalMessage = message

    if Settings.Blatant.MessageSpammer.UseEmojis then
        local randomEmojiIndex = math.random(1, #emojis)
        local emoji = emojis[randomEmojiIndex]
        finalMessage = finalMessage .. " " .. emoji
    end

    game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(finalMessage, "All")
end

--// Main CFrame speed
game:GetService("RunService").Heartbeat:Connect(function()
    if Settings.Blatant.CFrameSpeed.Enabled then
        if lplr.Character.Humanoid.MoveDirection.Magnitude > 0 then
            for i = 1, Settings.Blatant.CFrameSpeed.Value do
                lplr.Character:TranslateBy(lplr.Character.Humanoid.MoveDirection)
            end
        end
    end
end)


game:GetService("RunService").RenderStepped:Connect(function()
    FOVring.Visible = Settings.Aimbot.Fov.Enabled
    FOVring.Radius = Settings.Aimbot.Fov.Radius
    FOVring.Color = Settings.Aimbot.Fov.Color
end)

--// Config and shit
MenuGroup:AddButton("Unload Cheat", function()
    Library:Unload()
end)

MenuGroup:AddToggle("WatermarkEnabled", {
    Text = "Watermark",
    Default = true,
    Tooltip = "Watermark Enabled",
})

Toggles.WatermarkEnabled:OnChanged(function()
    Library:SetWatermarkVisibility(Toggles.WatermarkEnabled.Value)
end)

Library.ToggleKeybind = Options.MenuKeybind
ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()

Library:SetWatermark("Universal Aimbot and Esp made by Linemaster| " .. os.date(funny[math.random(1, #funny)], os.time()) .. day .. GetSubPrefix(day) .. os.date(second_string, os.time()))

SaveManager:SetIgnoreIndexes({"MenuKeybind"})

ThemeManager:SetFolder("AimbotAndEspFunny")
SaveManager:SetFolder("AimbotAndEspFunny/Configs")
SaveManager:BuildConfigSection(Tabs.UiSettings)
ThemeManager:ApplyToTab(Tabs.UiSettings)

MenuGroup:AddLabel("Menu bind"):AddKeyPicker("MenuKeybind", {
    Default = "Insert",
    NoUI = true,
    Text = "Menu keybind"
})

Library.ToggleKeybind = Options.MenuKeybind
